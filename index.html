<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>RPG Quest</title>

    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div id="game">
      <div id="arenaWrap">
        <div id="arenaStack">
          <div id="arena"></div>
          <div id="diceTray">
            <div class="diceHeader">üé≤ Rolagem r√°pida</div>
            <div class="diceControls">
              <div class="dieControl">
                <label for="diceCount4">d4</label>
                <input id="diceCount4" type="number" min="1" max="20" value="1" />
                <button type="button" class="dieBtn" onclick="rollDiceFromTray(4)">Rolar</button>
              </div>
              <div class="dieControl">
                <label for="diceCount6">d6</label>
                <input id="diceCount6" type="number" min="1" max="20" value="1" />
                <button type="button" class="dieBtn" onclick="rollDiceFromTray(6)">Rolar</button>
              </div>
              <div class="dieControl">
                <label for="diceCount8">d8</label>
                <input id="diceCount8" type="number" min="1" max="20" value="1" />
                <button type="button" class="dieBtn" onclick="rollDiceFromTray(8)">Rolar</button>
              </div>
              <div class="dieControl">
                <label for="diceCount10">d10</label>
                <input id="diceCount10" type="number" min="1" max="20" value="1" />
                <button type="button" class="dieBtn" onclick="rollDiceFromTray(10)">Rolar</button>
              </div>
              <div class="dieControl">
                <label for="diceCount12">d12</label>
                <input id="diceCount12" type="number" min="1" max="20" value="1" />
                <button type="button" class="dieBtn" onclick="rollDiceFromTray(12)">Rolar</button>
              </div>
              <div class="dieControl">
                <label for="diceCount20">d20</label>
                <input id="diceCount20" type="number" min="1" max="20" value="1" />
                <button type="button" class="dieBtn" onclick="rollDiceFromTray(20)">Rolar</button>
              </div>
              <div class="dieControl">
                <label for="diceCount100">d100</label>
                <input id="diceCount100" type="number" min="1" max="20" value="1" />
                <button type="button" class="dieBtn" onclick="rollDiceFromTray(100)">Rolar</button>
              </div>
            </div>
            <div id="diceResult">Use tamb√©m no chat: <code>/roll 2d6 + 1d4</code> (ou <code>/r 1d20</code>).</div>
          </div>
        </div>
      </div>

      <div id="sidebar">
        <div class="topRow">
          <h2 id="partyTitle">Grupo</h2>
          <div class="pills">
            <div class="pill" title="Seu nome">
              üë§ <strong id="meName">-</strong>
            </div>
            <button
              id="masterToggle"
              class="toggleBtn"
              onclick="toggleMasterMode()"
            >
              üõ†Ô∏è Mestre: OFF
            </button>
          </div>
        </div>

        <div id="scenePanel">
          <div style="font-weight: 900; margin-bottom: 8px">Cena</div>

          <div class="sceneGrid">
            <div class="field full">
              <label>Background (URL) ‚Äî cole um link direto de imagem</label>
              <input id="bgUrl" placeholder="Ex: https://.../mapa.png" />
            </div>

            <div class="field full">
              <label>Ou carregue um arquivo (local)</label>
              <input id="bgFile" type="file" accept="image/*" />
              <div class="sceneHint">
                Dica: arquivo local funciona s√≥ no seu PC; se quiser que
                ‚Äúmultiplayer‚Äù veja igual, use URL.
              </div>
            </div>

            <div class="field">
              <label>Zoom (Scale)</label>
              <input id="bgScale" type="range" min="40" max="300" value="120" />
            </div>
            <div class="field">
              <label>Opacidade</label>
              <input id="bgOpacity" type="range" min="0" max="100" value="65" />
            </div>

            <div class="field">
              <label>Offset X</label>
              <input id="bgX" type="range" min="-600" max="600" value="0" />
            </div>
            <div class="field">
              <label>Offset Y</label>
              <input id="bgY" type="range" min="-600" max="600" value="0" />
            </div>

            <div class="field full">
              <label>Ferramenta de Tiles (pintar m√≥dulos)</label>
              <div class="toolRow">
                <button
                  class="toolBtn active"
                  id="toolFloor"
                  onclick="setTool('floor')"
                >
                  üü¶ Ch√£o
                </button>
                <button class="toolBtn" id="toolWall" onclick="setTool('wall')">
                  üß± Parede
                </button>
                <button class="toolBtn" id="toolVoid" onclick="setTool('void')">
                  ‚¨õ Vazio
                </button>
                <button class="toolBtn" onclick="fillAll('floor')">
                  Preencher: Ch√£o
                </button>
                <button class="toolBtn" onclick="fillAll('wall')">
                  Preencher: Parede
                </button>
                <button class="toolBtn" onclick="fillAll('void')">
                  Preencher: Vazio
                </button>
                <button class="toolBtn" onclick="clearScene()">
                  Limpar Cena
                </button>
              </div>

              <div class="sceneHint" style="margin-top: 8px">
                Pintura r√°pida: clique e arraste.<br />
                Atalhos: <kbd>Shift</kbd> pinta Parede, <kbd>Alt</kbd> pinta
                Vazio, sem tecla pinta Ch√£o.
              </div>
            </div>
          </div>

          <hr class="sep" />

          <div class="sceneHint">
            Movimento: setas do teclado. Agora o token
            <strong>n√£o entra</strong> em Parede/Vazio.
          </div>
        </div>

        <div id="party"></div>

        <div id="chat"></div>

        <div id="chatInput">
          <input
            id="messageInput"
            placeholder="Digite mensagem... (Enter envia)"
          />
          <button onclick="sendMessage()">Enviar</button>
        </div>
      </div>
    </div>

    <!-- Modal Ficha -->
    <div id="sheetOverlay" class="modalOverlay">
      <div class="modal">
        <div class="modalHeader">
          <div>
            <h3 id="sheetTitle" class="modalTitle">Ficha</h3>
            <div id="sheetSub" class="modalSub"></div>
          </div>
          <button class="btn" onclick="closeSheet()">Fechar</button>
        </div>

        <div class="sheetColumns">
          <div class="panel">
            <div class="field">
              <label>Controlador (jogador)</label>
              <input id="sheetOwner" placeholder="Ex: Helton" />
            </div>
            <div class="field">
              <label>N√≠vel</label>
              <input id="sheetLevel" type="number" min="1" max="20" step="1" />
            </div>
            <div class="field">
              <label>Ra√ßa</label>
              <select id="sheetRace"></select>
            </div>
            <div class="field">
              <label>Classe</label>
              <select id="sheetClass"></select>
            </div>

            <div style="font-weight: 900; margin: 10px 0 8px">
              Equipados (vem do Invent√°rio)
            </div>
            <div id="equipSlots"></div>
            <div style="opacity: 0.7; font-size: 12px; margin-top: 8px">
              Para comprar/trocar/usar itens: abra o üéí Invent√°rio.
            </div>
          </div>

          <div class="panel">
            <div class="kv">
              <span>FOR</span><strong id="statSTR">-</strong>
            </div>
            <div class="kv">
              <span>DES</span><strong id="statDEX">-</strong>
            </div>
            <div class="kv">
              <span>ESP</span><strong id="statSPR">-</strong>
            </div>
            <div class="kv">
              <span>Defesa</span><strong id="statDEF">-</strong>
            </div>
            <div class="kv">
              <span>HP M√°x</span><strong id="statHPMax">-</strong>
            </div>
            <div class="kv">
              <span>MP M√°x</span><strong id="statMPMax">-</strong>
            </div>
            <div class="kv">
              <span>HP Atual</span><strong id="statHPNow">-</strong>
            </div>
            <div class="kv">
              <span>MP Atual</span><strong id="statMPNow">-</strong>
            </div>

            <div
              style="
                margin-top: 12px;
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
              "
            >
              <button
                class="smallBtn"
                onclick="editStat(sheetTargetName, 'hp')"
              >
                ‚ù§Ô∏è HP (+/-)
              </button>
              <button
                class="smallBtn"
                onclick="editStat(sheetTargetName, 'mana')"
              >
                üîµ MP (+/-)
              </button>
              <button
                class="smallBtn smallBtnPrimary"
                onclick="openInventory(sheetTargetName)"
              >
                üéí Invent√°rio
              </button>
            </div>
          </div>

          <div class="panel">
            <div style="font-weight: 900; margin-bottom: 8px">
              Habilidades (clic√°veis)
            </div>
            <div id="sheetAbilities" class="abilities"></div>
          </div>
        </div>

        <div class="sheetActions">
          <button class="btn" onclick="closeSheet()">Cancelar</button>
          <button class="btn btnPrimary" onclick="saveSheet()">Salvar</button>
        </div>
      </div>
    </div>

    <!-- Modal Invent√°rio + Loja -->
    <div id="invOverlay" class="modalOverlay">
      <div class="modal">
        <div class="modalHeader">
          <div>
            <h3 id="invTitle" class="modalTitle">Invent√°rio</h3>
            <div id="invSub" class="modalSub"></div>
          </div>
          <button class="btn" onclick="closeInventory()">Fechar</button>
        </div>

        <div class="invColumns">
          <div class="panel">
            <div class="invHeaderRow">
              <div class="goldPill">
                <span>ü™ô</span>
                <span>Ouro:</span>
                <strong id="goldValue">0</strong>
                <span style="opacity: 0.7">|</span>
                <span style="opacity: 0.85">Slots:</span>
                <strong id="invSlotsValue">0/0</strong>
              </div>
              <button
                class="smallBtn smallBtnPrimary"
                onclick="openSheet(invTargetName)"
              >
                üìú Voltar pra Ficha
              </button>
            </div>

            <div style="font-weight: 900; margin-bottom: 8px">
              Itens no Invent√°rio
            </div>
            <div id="invList" class="invList"></div>
          </div>

          <div class="panel">
            <div class="invHeaderRow">
              <div style="display: flex; gap: 8px; align-items: center">
                <div style="font-weight: 900">Loja</div>
                <span class="badge">resumo</span>
              </div>
              <select
                id="shopFilter"
                class="smallBtn"
                style="padding: 8px 10px"
              >
                <option value="all">Todos</option>
                <option value="weapon">Armas</option>
                <option value="armor">Armaduras</option>
                <option value="shield">Escudos</option>
                <option value="ring">Acess√≥rios</option>
                <option value="potion">Po√ß√µes</option>
              </select>
            </div>

            <div id="shopList" class="shopList"></div>

            <div style="opacity: 0.7; font-size: 12px; margin-top: 10px">
              Itens equip√°veis v√£o pra ficha quando equipados.
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
  </body>
</html>
